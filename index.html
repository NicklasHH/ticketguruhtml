<!DOCTYPE html>
<html xmlns:th="http://thymeleaf.org">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>Index</title>
    <style>
      body {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
      }
      form {
        text-align: center;
      }
    </style>
  </head>
  <body>
    <h3>Lipuntarkastus</h3>
    <form>
      <input type="text" id="käyttäjätunnus" value="admin" />
      <input type="text" id="salasana" value="admin" /><br /><br />
      <button type="button" onclick="haeToken()">Hae token</button><br /><br />


      <label for="lipunID">Lipun ID:</label>
      <input type="text" id="lipunID" value="1"/>
      <button <button type="button" onclick="haeLippu()">Hae lippu</button><br /><br />

      <button <button type="button" onclick="tarkistaLippu()">Tarkista lippu</button
    </form>
  </body>
</html>
<script>
  let tokenData;
  let bearerToken;
  let lippuId;
  let username = "admin"
  let password = "admin"

  function haeToken() {
    tokenData = {
      user: document.getElementById("käyttäjätunnus").value,
      password: document.getElementById("salasana").value,
    };
    username = document.getElementById("käyttäjätunnus").value,
    password = document.getElementById("salasana").value,
    console.log(tokenData);
    console.log(username);
    console.log(password);
  }


  function haeLippu() {
  console.log(bearerToken);
  lippuId = document.getElementById("lipunID").value;
  console.log(lippuId);

  const url = `http://ticketguru-ohjelmistoprojekti.rahtiapp.fi/api/tickets/${lippuId}`;
  const base64Credentials = btoa(`${username}:${password}`);

  fetch(url, {
    method: "GET",
    headers: {
      'Authorization': `Basic ${base64Credentials}`
    }
  })
    .then((response) => {
      if (response.ok) {
        return response.json();
      } else {
        throw new Error("Virheellinen vastaus API:sta");
      }
    })
    .then((data) => {
      console.log("Lipputiedot:", data);
    })
    .catch((error) => {
      console.error("Virhe:", error);
    });
}

function tarkistaLippu() {
  console.log(tokenData);
  console.log(bearerToken);
  console.log(lippuId);

  const url = `http://ticketguru-ohjelmistoprojekti.rahtiapp.fi/api/tickets/${lippuId}/check`;
  const base64Credentials = btoa(`${username}:${password}`);
  
  fetch(url, {
    method: "PATCH",
    headers: {
      'Authorization': `Basic ${base64Credentials}`
    }
  })
    .then((response) => {
      console.log("Palautuskoodi:", response.status);
      if (response.ok) {
        return response.json();
      } else {
        throw new Error("Virheellinen vastaus API:sta");
      }
    })
    .catch((error) => {
      console.error("Virhe:", error);
    });
}

  
  
</script>
